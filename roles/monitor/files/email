#!/bin/sh

# Taken from https://web.archive.org/web/20161011211420/https://dominicm.com/configure-email-notifications-on-arch-linux/

export HOME=~

EMAIL_HOST=$(curl -s checkip.dyndns.org|sed -e 's/.*Current IP Address: //' -e 's/<.*$//')
EMAIL_EXEC="mail"
EMAIL_ACCOUNT="gmail"
EMAIL_SUBJECT="Smartd has detected $SMARTD_FAILTYPE error on $SMARTD_DEVICE"
read -d '' EMAIL_BODY << EOF
Smartd error details:

Error type:            $SMARTD_FAILTYPE
Device node:         $SMARTD_DEVICESTRING
Date occurred:       $SMARTD_TFIRST

Below is the full original message generated by smartd:
------------------------------------------------------------------------------------------

$SMARTD_FULLMESSAGE

------------------------------------------------------------------------------------------
EOF

echo "$EMAIL_BODY" | $EMAIL_EXEC -A $EMAIL_ACCOUNT -s "$EMAIL_SUBJECT" $SMARTD_ADDRESS
